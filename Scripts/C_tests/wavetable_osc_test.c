/*
  gcc -o wavTest.out -Wall -Wextra wavetable_osc_test.c
 */

#include <stdint.h>
#include <stdio.h>

static __attribute__((unused)) uint32_t MIDI_LUT[128] = {0xb6fbc, 0xc1b88, 0xcd5a6, 0xd96ec, 0xe6683, 0xf40d7, 0x10297c, 0x112072, 0x1225b9, 0x133951,
														0x145ece, 0x15929c, 0x16dbe4, 0x183711, 0x19a7b8, 0x1b316d, 0x1ccd06, 0x1e8542, 0x20568c, 0x2240e4,
														0x244b72, 0x2672a2, 0x28bd9c, 0x2b28cd, 0x2db7c9, 0x3071b7, 0x335305, 0x365f45, 0x399a0d, 0x3d06f1,
														0x40a985, 0x4481c8, 0x489350, 0x4ce544, 0x5177a5, 0x56519b, 0x5b7326, 0x60e36f, 0x66a60a, 0x6cbe8b,
														0x7337b0, 0x7a1177, 0x81530a, 0x890390, 0x912a34, 0x99ca88, 0xa2ef4a, 0xac9fa2, 0xb6e2b9, 0xc1c34b,
														0xcd4881, 0xd97d17, 0xe66bcb, 0xf41f5a, 0x102a614, 0x1120721, 0x12250d4, 0x1339511, 0x145de94, 0x1593f44,
														0x16dc906, 0x1838696, 0x19a9496, 0x1b2fdc3, 0x1ccdb2c, 0x1e84249, 0x2054894, 0x2240e43, 0x244a53d, 0x2672a22,
														0x28bbd29, 0x2b27e89, 0x2db8e78, 0x30710c0, 0x3352598, 0x365f7f3, 0x399b658, 0x3d08492, 0x40a94bc, 0x44818f3,
														0x48946e6, 0x4ce5444, 0x5177de7, 0x56500a7, 0x5b71cf0, 0x60e1dec, 0x66a4b30, 0x6cbf37a, 0x733691c, 0x7a10590,
														0x8152979, 0x89031e6, 0x9128dcc, 0x99ca889, 0xa2efbcf, 0xac9fdba, 0xb6e3d75, 0xc1c3bd9, 0xcd49661, 0xd97e6f5,
														0xe66d238, 0xf420eb4, 0x102a52f3, 0x112063cd, 0x12251b98, 0x13395112, 0x145df40a, 0x1593ff09, 0x16dc7756,
														0x183877b2, 0x19a92cc2, 0x1b2fca56, 0x1ccda471, 0x1e8419d5, 0x2054a252, 0x2240cb2f, 0x244a3730, 0x2672a225,
														0x28bbe814, 0x2b27fa7e, 0x2db8eeac, 0x3070ef64, 0x335255f1, 0x365f94ac, 0x399b48e2, 0x3d0833ab, 0x40a944a4, 0x448192cb};

static __attribute__((unused)) uint16_t sin_LUT[257] = {32768,33572,34375,35178,35979,36779,37575,38369,39160,39947,40729,41507,42279,43046,43807,44560,
														45307,46046,46777,47500,48214,48919,49613,50298,50972,51635,52287,52927,53555,54170,54773,55362,
														55938,56499,57047,57579,58097,58600,59087,59558,60013,60451,60873,61278,61666,62036,62389,62724,
														63041,63339,63620,63881,64124,64348,64553,64739,64905,65053,65180,65289,65377,65446,65496,65525,
														65535,65525,65496,65446,65377,65289,65180,65053,64905,64739,64553,64348,64124,63881,63620,63339,
														63041,62724,62389,62036,61666,61278,60873,60451,60013,59558,59087,58600,58097,57579,57047,56499,
														55938,55362,54773,54170,53555,52927,52287,51635,50972,50298,49613,48919,48214,47500,46777,46046,
														45307,44560,43807,43046,42279,41507,40729,39947,39160,38369,37575,36779,35979,35178,34375,33572,
														32768,31963,31160,30357,29556,28756,27960,27166,26375,25588,24806,24028,23256,22489,21728,20975,
														20228,19489,18758,18035,17321,16616,15922,15237,14563,13900,13248,12608,11980,11365,10762,10173,
														9597,9036,8488,7956,7438,6935,6448,5977,5522,5084,4662,4257,3869,3499,3146,2811,
														2494,2196,1915,1654,1411,1187,982,796,630,482,355,246,158,89,39,10,
														0,10,39,89,158,246,355,482,630,796,982,1187,1411,1654,1915,2196,
														2494,2811,3146,3499,3869,4257,4662,5084,5522,5977,6448,6935,7438,7956,8488,9036,
														9597,10173,10762,11365,11980,12608,13248,13900,14563,15237,15922,16616,17321,18035,18758,19489,
														20228,20975,21728,22489,23256,24028,24806,25588,26375,27166,27960,28756,29556,30357,31160,31963, 32768};




typedef struct Oscillator
{
    uint32_t jump;
    uint32_t pos;
    uint16_t amp;
} osc;

osc o;

void nextAmp(void){
	uint32_t x0;
	uint64_t y;

	x0 = o.pos>>24;
	uint16_t y0 = sin_LUT[x0];
	uint16_t y1 = sin_LUT[x0 + 1];
	if(y1>y0){
		y = (uint64_t) ((o.pos&0x00FFFFFF)*(y1-y0));
		o.amp = y0 + (y>>24);
	}
	else{
		y = (uint64_t) ((o.pos&0x00FFFFFF)*(y0-y1));
		o.amp = y0 - (y>>24);
	}
	o.pos = o.pos + o.jump;
}

int main(void){
	FILE *fp;

	fp = fopen("sinGenerated.txt", "w");
	o.jump = MIDI_LUT[48];
	for(int i = 0; i<5000; i++){
		nextAmp();
		fprintf(fp, "%d,\n",o.amp);
	}
	fclose(fp);
}
